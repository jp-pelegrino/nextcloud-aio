# Nextcloud AIO Docker Compose Environment Configuration
# Copy this file to .env and adjust values as needed
# DO NOT commit the .env file - it may contain sensitive information

# ============================================================================
# NETWORK BINDING CONFIGURATION
# ============================================================================

# BIND_ADDR controls which network interface the services bind to
# - 0.0.0.0 = Listen on all interfaces (accessible from LAN and localhost)
# - 127.0.0.1 = Listen only on localhost (use with Cloudflare Tunnel)
# - <specific IP> = Listen only on a specific network interface
BIND_ADDR=0.0.0.0

# Host ports for HTTP, HTTPS, and Admin interface
# These are the ports exposed on your host machine
HTTP_HOST_PORT=80
HTTPS_HOST_PORT=8443
ADMIN_HOST_PORT=8080

# Redis/Valkey port (uncomment if you need to expose it for debugging)
# WARNING: Do not expose Redis to the internet without proper firewall rules
# REDIS_HOST_PORT=6379

# ============================================================================
# NEXTCLOUD AIO CONFIGURATION
# ============================================================================

# AIO container version (default: latest)
# Can also use 'beta' for testing new releases
AIO_VERSION=latest

# Container restart policy
RESTART_POLICY=always

# Docker socket path
# macOS: /var/run/docker.sock
# Windows/Docker Desktop: /var/run/docker.sock
# Docker rootless: /run/user/1000/docker.sock (adjust UID as needed)
HOST_DOCKER_SOCK=/var/run/docker.sock

# Skip domain validation (set to true when using Cloudflare Tunnel or reverse proxy)
# This allows Nextcloud to accept proxied domains that don't directly resolve to this server
SKIP_DOMAIN_VALIDATION=true

# ============================================================================
# APACHE / REVERSE PROXY CONFIGURATION
# ============================================================================

# Apache port for reverse proxy scenarios
# Set this when running behind a reverse proxy on the same host
APACHE_PORT=11000

# Apache IP binding for reverse proxy on same host
# Example: 127.0.0.1 (when reverse proxy is on same machine)
APACHE_IP_BINDING=

# Additional docker network for reverse proxy
# Use this if your reverse proxy runs in a different docker network
APACHE_ADDITIONAL_NETWORK=

# ============================================================================
# NEXTCLOUD DATA CONFIGURATION
# ============================================================================

# Nextcloud data directory on host
# WARNING: Do not change this after initial installation!
# Example: /mnt/nextcloud-data
NEXTCLOUD_DATADIR=

# Mount additional host directories into Nextcloud container
# This enables the local external storage feature
# Example: /mnt/shared
NEXTCLOUD_MOUNT=

# Trusted domains (comma-separated)
# Example: cloud.example.com,nextcloud.local
NEXTCLOUD_TRUSTED_DOMAINS=

# ============================================================================
# NEXTCLOUD RESOURCE LIMITS
# ============================================================================

# Upload limit for Nextcloud
NEXTCLOUD_UPLOAD_LIMIT=16G

# Max execution time for PHP scripts (seconds)
NEXTCLOUD_MAX_TIME=3600

# PHP memory limit per process
NEXTCLOUD_MEMORY_LIMIT=512M

# ============================================================================
# NEXTCLOUD APPS AND EXTENSIONS
# ============================================================================

# Apps to install on first startup (space-separated)
NEXTCLOUD_STARTUP_APPS=deck twofactor_totp tasks calendar contacts notes

# Additional OS packages to install permanently
NEXTCLOUD_ADDITIONAL_APKS=imagemagick

# Additional PHP extensions to install permanently
NEXTCLOUD_ADDITIONAL_PHP_EXTENSIONS=imagick

# Keep disabled apps instead of uninstalling them
NEXTCLOUD_KEEP_DISABLED_APPS=false

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================

# Borg backup retention policy
BORG_RETENTION_POLICY="--keep-within=7d --keep-weekly=4 --keep-monthly=6"

# Disable backup section in AIO interface
AIO_DISABLE_BACKUP_SECTION=false

# ============================================================================
# TALK CONFIGURATION
# ============================================================================

# Talk/TURN server port
TALK_PORT=3478

# ============================================================================
# HARDWARE ACCELERATION
# ============================================================================

# Enable /dev/dri device for hardware acceleration
# WARNING: Only set to true if /dev/dri exists on your host!
NEXTCLOUD_ENABLE_DRI_DEVICE=false

# Enable NVIDIA GPU support
# WARNING: Only set to true if you have an NVIDIA GPU installed!
NEXTCLOUD_ENABLE_NVIDIA_GPU=false

# ============================================================================
# REDIS / VALKEY CONFIGURATION
# ============================================================================

# Valkey/Redis image to use
# Default: Uses locally built image from Containers/valkey/Dockerfile
# Alternative: valkey/valkey:7.2-alpine (or similar official image)
VALKEY_IMAGE=nextcloud-aio-valkey:local

# Redis/Valkey password
# IMPORTANT: Set a strong password in production!
# Generate secure password: openssl rand -base64 32
# Example (DO NOT USE THIS): aB3$kL9mP2qR7sT4uV8wX1yZ5cD6eF0g
# Leave empty for no password (not recommended for production)
REDIS_HOST_PASSWORD=

# ============================================================================
# CLOUDFLARE TUNNEL CONFIGURATION (OPTIONAL)
# ============================================================================

# To use the in-compose cloudflared service:
# 1. Uncomment the cloudflared service in docker-compose.yml
# 2. Set CF_TUNNEL_TOKEN below (get this from Cloudflare Zero Trust dashboard)
# 3. Configure your tunnel to point to:
#    - http://nextcloud-aio-mastercontainer:80 (RECOMMENDED - HTTP origin)
#    - WARNING: Do NOT use https://nextcloud-aio-mastercontainer:8443 unless you configure noTLSVerify
#    - The mastercontainer uses a self-signed cert that will cause TLS errors
#    - Cloudflare handles HTTPS for external users; internal can be HTTP
# 4. IMPORTANT: Wait for mastercontainer to be fully started and healthy before tunnel will work
# 5. Set BIND_ADDR=127.0.0.1 if you want to prevent direct LAN access

# Cloudflare Tunnel token (from Zero Trust dashboard)
CF_TUNNEL_TOKEN=

# Cloudflare Tunnel version
CLOUDFLARED_VERSION=latest

# Alternative: Use credentials file instead of token
# CF_TUNNEL_CREDFILE=./cloudflared-credentials.json
# CF_TUNNEL_CONFIG=./cloudflared-config.yml

# ============================================================================
# ADVANCED CONFIGURATION
# ============================================================================

# Docker API version override (use at your own risk!)
# DOCKER_API_VERSION=1.44

# Collabora seccomp setting
COLLABORA_SECCOMP_DISABLED=false

# Fulltextsearch Java options
# FULLTEXTSEARCH_JAVA_OPTIONS=-Xms1024M -Xmx1024M

# Watchtower docker socket path (usually same as HOST_DOCKER_SOCK)
WATCHTOWER_DOCKER_SOCKET_PATH=/var/run/docker.sock

# Docker network MTU size
# DOCKER_NETWORK_MTU=1500

# ============================================================================
# SECURITY NOTES
# ============================================================================

# 1. Always use strong passwords for REDIS_HOST_PASSWORD
# 2. Never commit your .env file to version control
# 3. Use BIND_ADDR=127.0.0.1 when exposing via Cloudflare Tunnel only
# 4. Keep SKIP_DOMAIN_VALIDATION=true only when using proxied domains
# 5. Regularly update your containers by pulling the latest images
# 6. Use HTTPS origins when configuring Cloudflare Tunnel for better security

# ============================================================================
# EXAMPLES
# ============================================================================

# Example 1: Local LAN access only, no Cloudflare Tunnel
# BIND_ADDR=0.0.0.0
# SKIP_DOMAIN_VALIDATION=false
# (Keep cloudflared service commented out)

# Example 2: Cloudflare Tunnel only, no direct LAN access
# BIND_ADDR=127.0.0.1
# SKIP_DOMAIN_VALIDATION=true
# CF_TUNNEL_TOKEN=your-token-here
# (Uncomment cloudflared service in docker-compose.yml)

# Example 3: Both LAN and Cloudflare Tunnel access
# BIND_ADDR=0.0.0.0
# SKIP_DOMAIN_VALIDATION=true
# CF_TUNNEL_TOKEN=your-token-here
# (Uncomment cloudflared service in docker-compose.yml)
